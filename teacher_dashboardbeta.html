<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Dashboard | SVLS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: '#2563eb', // Modern Blue
                        secondary: '#1e293b', // Slate Dark
                        accent: '#f59e0b', 
                        danger: '#ef4444',
                        success: '#10b981'
                    }
                }
            }
        }
    </script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .active-nav { background: #2563eb; color: white; box-shadow: 0 4px 6px -1px rgb(37 99 235 / 0.2); }
        input[type="number"]::-webkit-inner-spin-button { display: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans h-screen flex overflow-hidden">

    <aside class="w-64 bg-secondary text-white flex flex-col shadow-2xl z-20">
        <div class="h-16 flex items-center px-6 border-b border-slate-700 bg-slate-900">
            <div class="font-bold text-lg tracking-wider flex items-center gap-2">
                <i class="fa-solid fa-chalkboard-user text-primary"></i> SVLS <span class="text-primary">FACULTY</span>
            </div>
        </div>
        
        <nav class="flex-1 py-6 px-3 space-y-1 overflow-y-auto scrollbar-hide">
            <p class="px-3 text-[10px] font-bold text-slate-500 uppercase tracking-[0.2em] mb-4">Assigned Subjects</p>
            <div id="subjectNav" class="space-y-2">
                <button onclick="selectSubject('IT101', this)" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-slate-700 group active-nav">
                    <div class="w-2 h-2 rounded-full bg-blue-400 group-hover:bg-white"></div>
                    <div class="text-left">
                        <p class="text-sm font-bold truncate">Web Development 1</p>
                        <p class="text-[10px] opacity-60">BSIT 3-A</p>
                    </div>
                </button>
            </div>
        </nav>

        <div class="p-4 border-t border-slate-700 bg-slate-900">
            <a href="#" class="flex items-center gap-3 mb-3 p-2 rounded-lg hover:bg-white/5 transition-all group">
                <div class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-sm font-bold text-white uppercase" id="teacherInitial">
                    TC
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-xs font-bold text-white truncate uppercase" id="teacherName">Loading...</p>
                    <p class="text-[10px] text-gray-400 uppercase flex items-center gap-1">
                        <i class="fa-solid fa-gear text-[8px]"></i> Settings
                    </p>
                </div>
                <i class="fa-solid fa-chevron-right text-gray-600 text-[10px]"></i>
            </a>
            <button onclick="logout()" class="w-full flex items-center justify-center gap-2 bg-red-600/10 hover:bg-red-600 text-red-500 hover:text-white py-2 rounded-md text-xs font-bold transition-all uppercase tracking-widest">
                <i class="fa-solid fa-right-from-bracket"></i> Logout
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full overflow-hidden">
        <header class="h-16 bg-white shadow-sm flex items-center justify-between px-8 z-10 border-b border-gray-100">
            <div class="flex flex-col">
                <h1 id="activeSubjectTitle" class="text-lg font-bold text-gray-800">Select a Subject</h1>
                <p id="studentCount" class="text-[10px] text-gray-400 font-bold uppercase tracking-wider"></p>
            </div>
            
            <div class="flex items-center gap-3">
                <div id="viewToggles" class="hidden bg-gray-100 p-1 rounded-lg flex gap-1">
                    <button onclick="switchView('attendance')" class="px-4 py-1.5 text-xs font-bold rounded-md transition-all bg-white shadow-sm text-primary">Attendance</button>
                    <button onclick="switchView('grades')" class="px-4 py-1.5 text-xs font-bold rounded-md transition-all text-gray-500 hover:text-gray-700">Grades</button>
                </div>
                <button onclick="saveAll()" id="saveBtn" class="hidden bg-primary hover:bg-blue-700 text-white px-6 py-2 rounded-lg text-xs font-bold shadow-md transition-all">
                    SAVE CHANGES
                </button>
            </div>
        </header>

        <div id="workspace" class="flex-1 overflow-y-auto p-8 scrollbar-hide">
            <div id="contentPlaceholder" class="h-full flex flex-col items-center justify-center text-gray-400 italic">
                <i class="fa-solid fa-folder-open text-5xl mb-4 opacity-20"></i>
                <p>Select a subject from the left to manage records.</p>
            </div>

            <div id="mainTableCard" class="hidden bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div id="tableHeader" class="px-6 py-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center">
                    </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead id="tableHead" class="bg-gray-50 text-gray-500 text-[10px] uppercase font-bold tracking-wider">
                            </thead>
                        <tbody id="tableBody" class="divide-y divide-gray-100 text-sm text-gray-700">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
         import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, doc, getDoc, addDoc, onSnapshot, deleteDoc, serverTimestamp, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyDaeNQF4qmW0vvwxUPp_NztnT0hoLzm1BQ",
            authDomain: "svls-289ee.firebaseapp.com",
            projectId: "svls-289ee",
            storageBucket: "svls-289ee.firebasestorage.app",
            messagingSenderId: "500705386198",
            appId: "1:500705386198:web:96f189662bc2aa99cf7377"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        let currentView = 'attendance';
        let activeSubject = null;

        window.selectSubject = (code, element) => {
            activeSubject = code;
            document.getElementById('activeSubjectTitle').innerText = code;
            document.getElementById('studentCount').innerText = "24 Students Enrolled"; // Placeholder logic
            
            // UI Switch
            document.querySelectorAll('#subjectNav button').forEach(b => b.classList.remove('active-nav'));
            element.classList.add('active-nav');
            
            document.getElementById('contentPlaceholder').classList.add('hidden');
            document.getElementById('mainTableCard').classList.remove('hidden');
            document.getElementById('viewToggles').classList.remove('hidden');
            document.getElementById('saveBtn').classList.remove('hidden');
            
            renderData();
        };

        window.switchView = (view) => {
            currentView = view;
            // Toggle Button Styles
            const buttons = document.querySelectorAll('#viewToggles button');
            buttons.forEach(b => {
                b.classList.toggle('bg-white', b.innerText.toLowerCase() === view);
                b.classList.toggle('shadow-sm', b.innerText.toLowerCase() === view);
                b.classList.toggle('text-primary', b.innerText.toLowerCase() === view);
                b.classList.toggle('text-gray-500', b.innerText.toLowerCase() !== view);
            });
            renderData();
        };

        function renderData() {
            const head = document.getElementById('tableHead');
            const body = document.getElementById('tableBody');
            const headerInfo = document.getElementById('tableHeader');

            if (currentView === 'attendance') {
                headerInfo.innerHTML = `<h2 class="font-bold text-xs uppercase tracking-widest text-gray-500">Attendance: ${new Date().toLocaleDateString()}</h2>`;
                head.innerHTML = `<tr><th class="px-6 py-4">Student Name</th><th class="px-6 py-4 text-center">Status</th></tr>`;
                body.innerHTML = `
                    <tr>
                        <td class="px-6 py-4 font-bold">DELA CRUZ, JUAN</td>
                        <td class="px-6 py-4 text-center">
                            <select class="bg-gray-100 border-none rounded-lg text-xs font-bold p-2 outline-none">
                                <option>PRESENT</option>
                                <option>LATE</option>
                                <option>ABSENT</option>
                            </select>
                        </td>
                    </tr>`;
            } else {
                headerInfo.innerHTML = `<h2 class="font-bold text-xs uppercase tracking-widest text-gray-500 italic underline decoration-primary">College Grading Matrix (1.0 - 5.0)</h2>`;
                head.innerHTML = `<tr>
                    <th class="px-6 py-4">Student Name</th>
                    <th class="px-6 py-4 text-center">Prelim</th>
                    <th class="px-6 py-4 text-center">Midterm</th>
                    <th class="px-6 py-4 text-center">Final</th>
                    <th class="px-6 py-4 text-center">Average</th>
                    <th class="px-6 py-4 text-right">Point</th>
                </tr>`;
                body.innerHTML = renderGradesTemplate();
            }
        }

        function renderGradesTemplate() {
            // Logic for calculation
            return `<tr>
                <td class="px-6 py-4 font-bold">DELA CRUZ, JUAN</td>
                <td class="px-6 py-4 text-center"><input type="number" oninput="calc(this)" class="w-16 bg-gray-50 border border-gray-200 rounded p-1 text-center font-medium" value="95"></td>
                <td class="px-6 py-4 text-center"><input type="number" oninput="calc(this)" class="w-16 bg-gray-50 border border-gray-200 rounded p-1 text-center font-medium" value="92"></td>
                <td class="px-6 py-4 text-center"><input type="number" oninput="calc(this)" class="w-16 bg-gray-50 border border-gray-200 rounded p-1 text-center font-medium" value="94"></td>
                <td class="px-6 py-4 text-center font-black text-primary">93.67</td>
                <td class="px-6 py-4 text-right">
                    <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full font-bold text-[10px]">1.25</span>
                </td>
            </tr>`;
        }

        window.calc = (input) => {
            // Point conversion logic as established previously
        };
    </script>
</body>
</html>
